#!/bin/bash

mons=$(xrandr | awk '/ connected/ {print $1}')

comman=$(cat /home/user/.config/xrandr_set)

execute="xrandr"

i=2
declare -i i

while [ $i -ge 0 ]
do
	add=$(echo "$comman" | awk -v var="$i" -F "--output" '{print $var}')
	if ! [ "$(echo -e "$mons" | grep "$(echo "$add" | awk '{print $1}')")" = "" ];then
		if ! [ "$add" = "" ];then
			execute=$execute' --output'$add
		fi
	else
		if ! [ "$add" = "" ];then
			execute=$execute' --output '$(echo "$add" | awk '{print $1}')' --off'
		fi
	fi
	i=$i+1
	if [ "$add" = "" ];then
		i=-1
	fi
done

i=1
while [ $i -ge 0 ]
do
	check=$(echo "$execute" | awk -v var="$i" '{print $var}')
	i=$i+1
	if [ "$check" = "--same-as" ];then
		if [ "$(echo -e "$mons" | grep "$(echo "$execute" | awk -v var="$i" '{print $var}')")" = "" ];then
			declare -i a
			a=$i-1
			execute=$(echo $execute | awk -v var="$a" '{$var=""}1' | awk -v var="$a" '{$var=""}1')
			i=$i-2
		fi
	elif [ "$check" = "" ];then
		i=-2
	fi

done

declare -i count
count=0

i=1
while [ $i -ge 0 ]
do
	check=$(echo "$execute" | awk -v var="$i" '{print $var}')
	i=$i+1
	if [ "$check" = "--pos" ];then
		pos=$(echo "$execute" | awk -v var="$i" '{print $var}')
		x=$(echo "$pos" | awk -F "x" '{print $1}')
		y=$(echo "$pos" | awk -F "x" '{print $2}')
		declare -i x
		declare -i y
		if [ $count = 0 ];then
			max_x=$x
			max_y=$y
			declare -i max_x
			declare -i max_y
		fi
		if [ "$x" -ge "$max_x" ];then
			max_x=$x
		fi
		if [ "$y" -ge "$max_y" ];then
			max_y=$y
		fi
		count=$count+1
	elif [ "$check" = "" ];then
		i=-2
	fi
done

if [ -1 -ge "$max_x" ] || [ -1 -ge "$max_y" ];then
	if [ -1 -ge "$max_x" ];then
		max_x=$max_x*-1
	else
		max_x=0
	fi
	if [ -1 -ge "$max_y" ];then
		max_y=$max_y*-1
	else
		max_y=0
	fi

	i=1
	while [ $i -ge 0 ]
	do
		check=$(echo "$execute" | awk -v var="$i" '{print $var}')
		i=$i+1
		if [ "$check" = "--pos" ];then
			pos=$(echo "$execute" | awk -v var="$i" '{print $var}')
			x=$(echo "$pos" | awk -F "x" '{print $1}')
			y=$(echo "$pos" | awk -F "x" '{print $2}')
			declare -i x
			declare -i y
			x=$x+$max_x
			y=$y+$max_y
			pos=$x'x'$y
			execute=$(echo "$execute" | awk -v var="$i" -v var2="$pos" '{$var=var2}1')
		elif [ "$check" = "" ];then
			i=-2
		fi
	done
fi

$execute
